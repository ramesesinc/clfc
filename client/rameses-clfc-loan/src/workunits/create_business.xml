<workunit extends="wtemplates/PopupMasterController.xml">
    <invokers>
        <invoker type="business:create" action="create" caption="Business Form" target="popup"/>
        <invoker type="business:open" caption="Business Form" target="popup"/>
    </invokers>
    <code>
        <![CDATA[
            import com.rameses.rcp.common.*;
            import com.rameses.rcp.annotations.*;
            import com.rameses.osiris2.client.*;
            import com.rameses.clfc.util.LoanUtil;
            import java.rmi.server.UID;
            
            class BusinessFormController extends com.rameses.clfc.loan.controller.PopupMasterController
            {
                @PropertyChangeListener
                def listener = [
                    "entity.occupancy.type": {o->
                        if( o != 'RENTED' ) {
                            entity.occupancy.renttype = null;
                            entity.occupancy.rentamount = null;
                            binding.refresh('entity.occupancy.rent.*');
                        }
                    }
                ];
                
                def kindTypes = LoanUtil.kindTypes;
                def occupancyTypes = LoanUtil.occupancyTypes;
                def rentTypes = LoanUtil.rentTypes;
                def ownershipTypes = LoanUtil.ownershipTypes;
                
                public def createEntity() {
                    return [ objid: 'BUSS'+new UID(), occupancy:[:] ]
                }
                
                public def doOk() {
                    if( entity.occupancy.type == 'RENTED' ) {
                        if( !entity.occupancy.renttype ) throw new Exception("Rent Type is required.")
                        if( !entity.occupancy.rentamount ) throw new Exception("Rent Amount is required.")
                    }
                    
                    return super.doOk()
                }
            }
        ]]>
    </code>
    <pages>
        <page template="com.rameses.clfc.loan.business.BusinessFormPage"/>
    </pages>
</workunit>