import com.rameses.common.*;
import com.rameses.annotations.*;
import com.rameses.services.extended.*;

class LoanVoidPaymentService extends ActiveListService
{
	@ActiveDB(value="void_payment")
	def em;

	@Service("CustomerService")
	def customerSvc;

	@ProxyMethod
	public def getNodes( params ) {
		return [
			[caption: 'PENDING', state: 'PENDING', name: 'pending', filetype: 'voidrequest'],
			[caption: 'APPROVED', state: 'APPROVED', name: 'approved', filetype: 'voidrequest']
		]
	}

	@ProxyMethod
	public def getColumns( params ) {
		return [
			[name: 'state', caption: 'State'],
			[name: 'route.area', caption: 'Route Area'],
			[name: 'appno', caption: 'App. No.'],
			[name: 'borrower.name', caption: 'Borrower'],
			[name: 'collector.name', caption: 'Requested By'],
			[name: 'reason', caption: 'Reason']
		]
	}

	void beforeList( Object data ) {
		data.state = (data.state? data.state : '%');
	}

	@ProxyMethod
	public def create( params ) {
		params.state = 'PENDING';
		em.create(params);
		return open(params)
	}

	@ProxyMethod
	public def approve( params ) {
		em.update(params, "remarks");
		em.changeStateApproved(params);
		return params;
	}

	@ProxyMethod
	public def open( params ) {
		params = em.findVoidRequestById(params);
		return params;
	}

	@ProxyMethod
	public def openCustomer( params ) {
		def customer = customerSvc.open(params);
		return [address: customer.address, objid: customer.objid, name: customer.name];
	}
}