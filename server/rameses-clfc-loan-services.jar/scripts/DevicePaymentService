import com.rameses.common.*;
import com.rameses.annotations.*;
import com.rameses.server.common.*;

class DevicePaymentService
{
	@ActiveDB(value="loan_ledger")
	def ledger;

	@Service("LoanPaymentService")
	paymentSvc;

	@ProxyMethod
	public def postPayment( payment ) {
		payment.appid = payment.loanappid;
		payment.remove("loanappid");
		payment.payamount = payment.amount;
		payment.remove("amount");
		payment.paytype = payment.type;
		payment.remove("type");
		def lr = ledger.findByAppId(payment);
		if (!lr) throw new Exception("Ledger does not exist.");

		if (lr.updatetype == 0) {
			lr.updatetype = 1;
			ledger.update(lr, "updatetype");
		}
		paymentSvc.postPayment(payment);
	}
}