import com.rameses.common.*;
import com.rameses.annotations.*;

class LoanLedgerBillingTask
{
	@ActiveDB(value="loan_ledger_billing")
	def ledger_billing;

	@Service("DateService")
	def dateSvc;

	@Schedule(interval=1, timeUnit="DAYS", immediate=true)
	public void cancelPastDraftBillings( task ) {
		def date = dateSvc.serverDate;
		def list = ledger_billing.getPastDraftBillings([date: date.toString().split(' ')[0]]);
		list.each{
			it.dtcancelled = date;
			it.cancelledby = 'SYSTEM';
			it.remarks = 'Billing was not used.';
			it.state = 'CANCELLED';
			ledger_billing.update(it);
		}
	}
}